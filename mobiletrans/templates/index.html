{% extends "base.html" %}


{% block extra_head %}{{ block.super }}

<script type="text/javascript">

$(document).ready(function(){

	var markersArray = [];

	var myLatlng = new google.maps.LatLng(41.875696,-87.624207);
	var myOptions = {
	  zoom: 11,
	  center: myLatlng,
	  mapTypeId: google.maps.MapTypeId.ROADMAP
	}

	var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	    
	//var ctaLayer = new google.maps.KmlLayer('{{ url }}');
	//ctaLayer.setMap(map);

    google.maps.event.addListener(map, 'click', function(event) {
      deleteOverlays();
      addMarker(event.latLng);
	  var ctaLayer = new google.maps.KmlLayer('{{ url }}&lat=' + event.latLng.lat() + '&long=' + event.latLng.lng() );
	  ctaLayer.setMap(map);
    });
    
    
    function addMarker(location) {
    marker = new google.maps.Marker({
      position: location,
      map: map
    });
    markersArray.push(marker);
    }
    
    // Deletes all markers in the array by removing references to them
	function deleteOverlays() {
	  if (markersArray) {
	    for (i in markersArray) {
	      markersArray[i].setMap(null);
	    }
	    markersArray.length = 0;
	  }
	}

	$('#loadingDiv')
	    .hide()  // hide it initially
	    .ajaxStart(function() {
	        $(this).show();
	    })
	    .ajaxStop(function() {
	        $(this).hide();
	    })
	;


    $(".block-buttons li.top a.top_a").click(function () {
      $(".block-buttons .level1").slideToggle("slow");
      return false; 
    });

    $(".block-buttons li.level1 a.level1_a").click(function () {
	  var clicked_element = $(this);
	  var clicked_parent = clicked_element.parent();
	  /* alert(clickec_element); */
	 
	 if ( clicked_parent.children('ul').children('li.level2').size() == 0 ) {
	      $.getJSON('api/1/transitroutes/f757cf70-c325-11e0-a70d-002332d6d7e4/transitroute.json', 
	        function(data) {
	        	var route = data.transit_route
	
				ul = $('<ul>');
				$.each(route.stops,
				function( intIndex, objValue )
				{
					 a = $("<a/>").attr("href","").css("color",clicked_element.css('background-color')).text(objValue.name);
					 li = $('<li>').attr("class",'level2').append(a);
					 ul.append(li);
				});
				clicked_parent.append(ul)
			});
   		}
   		else
   		{
   			clicked_parent.children('ul').children('li.level2').toggle('slow');
   		}
   	   
      return false; 
    });

});

</script>

{% endblock extra_head %}

{% block active_index %}active{% endblock active_index %}

{% block content %}
<div id='loadingDiv'>Loading..<img src="{{ STATIC_URL }}/image/ajax-loader.gif"></div>

<div class="block-center block-buttons">
<ul>
<li class="top"><a class="top_a" href="">Find a Train Stop</a>
	<ul>
	<li class="level1"><a class="level1_a" id="red" href="">Red Line</a></li>
	<li class="level1"><a class="level1_a" id="blue" href="">Blue Line</a></li>
	<li class="level1"><a class="level1_a" id="orange" href="">Orange Line</a></li>
	<li class="level1"><a class="level1_a" id="purple" href="">Purple Line</a></li>
	<li class="level1"><a class="level1_a" id="pink" href="">Pink Line</a></li>
	<li class="level1"><a class="level1_a" id="green" href="">Green Line</a></li>
	<li class="level1"><a class="level1_a" id="yellow" href="">Yellow Line</a></li>
	<li class="level1"><a class="level1_a" id="brown" href="">Brown Line</a></li>
	</ul>
</li>

</ul>
</div>

<div class="block-center block-desc">
<p>Click the map within Chicago to locate nearby landmarks and determine the neighborhood.</p>
</div>

<div class="block-center block-box black-box-map">

<div id="map_canvas" style="width:100%; height:100%"></div>
{# <iframe width="640" height="480" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps?f=q&amp;hl=en&amp;q={{ url }}&amp;ie=UTF8&amp;om=1&amp;ll=41.881944,-87.627778&amp;spn=0.006776,0.013733&amp;z=12&amp;output=embed"></iframe><br /><small><a href="http://maps.google.com/maps?f=q{}&amp;hl=en&amp;q={{ url }}&amp;ie=UTF8&amp;om=1&amp;ll=48.858193,2.289619&amp;spn=0.006776,0.013733&amp;z=17&amp;source=embed" style="color:white;text-align:left">View Larger Map</a></small>  #}

</div>


{% endblock content %}
	